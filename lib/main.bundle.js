!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.$DrawTable=e():t.$DrawTable=e()}(self,(function(){"use strict";var t,e={};function i(t,e){var i,s=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)),s}function s(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?i(Object(s),!0).forEach((function(e){var i,r;i=t,r=s[e],e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function r(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t=e,"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0});var a,n=function(){function t(e,i){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.config=e,this.mode="select",this.drawType={type:"cell",td:1,tr:1},this.startX=0,this.startY=0,this.moveX=0,this.moveY=0,this.leftDistance=0,this.topDistance=0,this.c=null,this.ctx=null,this.resize=6,this.mouseStatus=null,this.tableStatus=null,this.layers=[],this.history=[],this.deleteHistory=[],this.isOpt="",this.originCurrent=null,this.current=null,this.coord=null,this.currentArray=[],this.currentArrayItem=null,this.base=0,this.scrollRateY=20,this.scrollRateX=20,this.timerX=null,this.timerY=null,this.timerTop=null,this.cellMatchList=[],this.cellflowList=[],this.clientY=0,this.clientX=0,this.match={type:"",index:0},this.noUpdate=!0,this.saveCurrent=[],this.imgRate=1,this.img=new Image,this.modeChange=i,this.tempy=0,this.selectColor=e.selectColor||"#666",this.selectActiveColor=e.selectActiveColor||"red",this.drawSelectColor=e.drawSelectColor||"#0099CC",this.init()}var e,i;return e=t,(i=[{key:"init",value:function(){"object"===o(this.config.dom)&&"nodeType"in this.config.dom?this.c=this.config.dom:this.c=document.getElementById(this.config.dom),this.ctx=this.c.getContext("2d"),this.c.width=document.body.clientWidth,this.c.height=document.body.clientHeight-64,this.addMouseEvent(),this.config.url?this.drawImage():this.drawOriginData(),this.addKeyboard()}},{key:"addMouseEvent",value:function(){this.c.onmousedown=this.mousedown.bind(this),this.c.onmousemove=this.mousemove.bind(this),this.c.onmouseup=this.mouseup.bind(this)}},{key:"mousedown",value:function(t){var e=this.windowToCanvas(t.clientX,t.clientY);switch(this.startX=e.x,this.startY=e.y,this.mouseStatus="down",this.mode){case"select":this.originCurrent=this.isPointInRetc(e.x,e.y);break;case"drawSelect":var i=this.layers.findIndex((function(t){return"select"===t.type}));-1!==i&&this.layers.splice(i,1);break;case"move":this.current?(i=this.isPointInRetc(e.x,e.y),(this.originCurrent=i)?(this.leftDistance=e.x-i.x1,this.topDistance=e.y-i.y1):(this.mode="select",this.current.type,this.current=null)):0<this.currentArray.length&&(i=this.isPointInRetc(e.x,e.y),this.originCurrent=r(this.currentArray),i?this.currentArrayItem=i:(this.mode="select",this.current=null,this.currentArray=[]));break;case"draw":this.originCurrent=null}}},{key:"addKeyboard",value:function(){var t=this;document.addEventListener("keydown",(function(e){e.key&&("delete"===e.key.toString().toLowerCase()&&t.delete(),(e.metaKey&&"z"===e.key.toString().toLowerCase()||e.ctrlKey&&"z"===e.key.toString().toLowerCase())&&0<t.history.length&&t.revoke(),(e.metaKey&&"s"===e.key.toString().toLowerCase()||e.ctrlKey&&"s"===e.key.toString().toLowerCase())&&!t.noUpdate&&t.saveDraw(),e.ctrlKey&&"="===e.key&&t.zoom("up"),e.ctrlKey&&"-"===e.key&&t.zoom("down"))}))}},{key:"mouseup",value:function(t){var e,i,h,o,a=this,n=(t.preventDefault(),this.clearTimer(),this.windowToCanvas(t.clientX,t.clientY)),l=(this.mouseStatus="up",this.tableStatus="",[]);if(this.match={type:"",index:0},"select"===this.mode||"move"===this.mode)this.isOpt?"move"===this.isOpt&&0<this.currentArray.length&&(e=[],this.layers.forEach((function(t){-1!==a.currentArray.findIndex((function(e){return e.key===t.key}))&&e.push(t)})),this.currentArray=[].concat(e),this.current=null,this.base=0,this.cellMatchList=[],this.cellflowList=[]):this.current&&"select"===this.current.type||((i=this.isPointInRetc(n.x,n.y))?(t.ctrlKey?-1!==(n=this.currentArray.findIndex((function(t){return t.key===i.key})))?this.currentArray.splice(n,1):this.currentArray.push(i):(this.current=i,this.currentArray=[]),this.c.style.cursor="move"):this.c.style.cursor="default"),this.current?this.mode="move":this.current=null,this.draw();else if("draw"===this.mode&&"draw"===this.isOpt){if(Math.abs(this.moveX-this.startX)>2*this.resize&&Math.abs(this.moveY-this.startY)>2*this.resize){if("table"===(t="drawSelect"===this.mode?"select":this.drawType.type)){for(var c=this.drawType.td,u=this.drawType.tr,y=this.moveX-this.startX,m=this.moveY-this.startY,d=0;d<c;d++)for(var v=0;v<u;v++){var f=this.startX+y/c*d,x=this.startX+y/c*(d+1),p=this.startY+m/u*v,g=this.startY+m/u*(v+1);f=this.fixPosition({x1:f,y1:p,x2:x,y2:g,type:"cell",key:(new Date).getTime()+"cell"+f+p,location:this.getCellLocation("",{x1:f,x2:x,y1:p,y2:g})}),l.push(f),this.layers.push(f)}this.c.style.cursor="default",this.currentArray=l}else n=(new Date).getTime()+("drawSelect"===this.mode?"select":this.drawType.type)+this.startX+this.startY,t=this.fixPosition({x1:this.startX,y1:this.startY,x2:this.moveX,y2:this.moveY,type:t,key:n,coord:this.coord,h:this.drawType.tr,w:this.drawType.td,location:this.getCellLocation("draw"),coordLocation:"table"===this.drawType.type?this.getTableLocation("draw"):{}}),this.layers.push(t),this.current=t;this.mode="move",this.c.style.cursor="default",this.modeChange("select")}else this.isOpt="";this.draw()}else"drawSelect"===this.mode&&(n=(new Date).getTime()+("drawSelect"===this.mode?"select":this.drawType.type)+this.startX+this.startY,this.findSelectArray(this.fixPosition({x1:this.startX,y1:this.startY,x2:this.moveX,y2:this.moveY,type:"select",key:n,location:this.getCellLocation("draw")})),this.isOpt="",this.mode="move",this.c.style.cursor="default",this.current=null,this.modeChange("select"),this.draw());!this.isOpt||"drawSelect"===this.mode||this.current&&"select"===this.current.type&&0===this.currentArray.length||(this.noUpdate=this.checkIsSave(),this.history.length>=this.config.historyCount&&this.history.shift(),this.current&&"select"===this.current.type?(h=[],this.layers.forEach((function(t){a.currentArray.forEach((function(e){t.key===e.key&&h.push(s({},t))}))})),this.history.push({type:this.isOpt,data:h,originData:r(this.currentArray),selectOpt:!0}),this.deleteHistory=[],this.currentArray=h):(0<this.currentArray.length?this.history.push({type:this.isOpt,data:r(this.currentArray),originData:this.originCurrent?r(this.originCurrent):null,selectOpt:!0}):(o=this.current||o,this.history.push({type:this.isOpt,data:s({},o),originData:s({},this.originCurrent)})),this.deleteHistory=[]),this.isOpt="")}},{key:"mousemove",value:function(t){var e,i,s,r,h,o,a=this,n=(t.preventDefault(),this.windowToCanvas(t.clientX,t.clientY));if(this.moveX=n.x,this.moveY=n.y,"down"===this.mouseStatus&&"select"!==this.mode&&(i=(e=this.c.parentElement).clientHeight,s=e.clientWidth,r=this.c.height-i,h=this.c.width-s,n.y-e.scrollTop>=e.clientHeight-2?(clearInterval(this.timerY),this.timerY=setInterval((function(){a.scrollRateY>=r&&(clearInterval(a.timerY),a.timerY=null),t.clientY-a.tempy<-1?(clearInterval(a.timerY),a.timerY=null):a.tempy=t.clientY,e.scrollTop+=a.scrollRateY/2}),60)):(clearInterval(this.timerY),this.scrollRateY=20),t.clientX>s-2?(clearInterval(this.timerX),this.timerX=setInterval((function(){a.scrollRateX>=h&&(clearInterval(a.timerX),a.timerX=null),e.scrollLeft+=a.scrollRateX/2}),60)):(clearInterval(this.timerX),this.scrollRateX=20),0<(o=e.scrollTop)&&t.clientY<80?(clearInterval(this.timerTop),this.timerTop=setInterval((function(){o<=0&&(clearInterval(a.timerTop),a.timerTop=null),e.scrollTop-=a.scrollRateY/2}),60)):(clearInterval(this.timerTop),this.scrollRateY=20)),"move"===this.mode&&(this.current?(this.current.x1+this.resize<=this.moveX&&this.current.x2-this.resize>=this.moveX&&this.current.y1+this.resize<=this.moveY&&this.current.y2-this.resize>=this.moveY||"moving"===this.tableStatus?(this.c.style.cursor="move","down"===this.mouseStatus&&this.movetable()):this.c.style.cursor="default","select"!==this.current.type&&this.reSizeTable()):0<this.currentArray.length&&(this.checkMultiple()?(this.c.style.cursor="move","down"===this.mouseStatus&&this.movetable()):this.c.style.cursor="default",this.resizeMultipleCell())),"draw"===this.mode&&"down"===this.mouseStatus||"drawSelect"===this.mode&&"down"===this.mouseStatus){if(this.ctx.save(),this.ctx.beginPath(),this.draw(),this.ctx.setLineDash([5]),this.c.style.cursor="crosshair","drawSelect"===this.mode)this.ctx.strokeStyle=this.selectColor,this.ctx.rect(this.startX,this.startY,this.moveX-this.startX,this.moveY-this.startY);else{this.coord={tr:[],td:[]};for(var l=0;l<=this.drawType.tr;l++)this.ctx.moveTo(this.startX,this.startY+l*(this.moveY-this.startY)/this.drawType.tr),this.ctx.lineTo(this.moveX,this.startY+l*(this.moveY-this.startY)/this.drawType.tr),this.coord.tr.push({x1:this.startX,y1:this.startY+l*(this.moveY-this.startY)/this.drawType.tr,x2:this.moveX,y2:this.startY+l*(this.moveY-this.startY)/this.drawType.tr});for(var c=0;c<=this.drawType.td;c++)this.ctx.moveTo(this.startX+c*(this.moveX-this.startX)/this.drawType.td,this.startY),this.ctx.lineTo(this.startX+c*(this.moveX-this.startX)/this.drawType.td,this.moveY),this.coord.td.push({x1:this.startX+c*(this.moveX-this.startX)/this.drawType.td,y1:this.startY,x2:this.startX+c*(this.moveX-this.startX)/this.drawType.td,y2:this.moveY})}this.isOpt="draw",this.ctx.stroke(),this.ctx.restore()}}},{key:"clearTimer",value:function(){clearInterval(this.timerY),clearInterval(this.timerY),clearInterval(this.timerTop),this.timerY=null,this.timerX=null,this.timerTop=null,this.scrollRateY=20,this.scrollRateX=20,this.tempy=0}},{key:"checkMultiple",value:function(){var t=this,e=!1;return this.currentArray.forEach((function(i){(i.x1+t.resize<=t.moveX&&i.x2-t.resize>=t.moveX&&i.y1+t.resize<=t.moveY&&i.y2-t.resize>=t.moveY||"moving"===t.tableStatus)&&(e=!0)})),e}},{key:"resizeMultipleCell",value:function(){if("moving"!==this.tableStatus){for(var t=r(this.currentArray),e="",i=0;i<t.length;i++){if(this.moveX>=t[i].x1&&this.moveX<=t[i].x1+this.resize&&this.moveY>=t[i].y1&&this.moveY<=t[i].y2&&"m-left-resize"!==this.tableStatus){this.moveX>=t[i].x1+1&&(this.c.style.cursor="w-resize"),e="left",this.base=t[i].x1;break}if(this.moveX<t[i].x2&&this.moveX>=t[i].x2-this.resize&&this.moveY>=t[i].y1&&this.moveY<=t[i].y2&&"m-right-resize"!==this.tableStatus){this.moveX<t[i].x2-1&&(this.c.style.cursor="e-resize"),e="right",this.base=t[i].x2;break}if(this.moveX<=t[i].x2-this.resize&&this.moveX>=t[i].x1+this.resize&&this.moveY<=t[i].y1+this.resize&&this.moveY>=t[i].y1&&"m-top-resize"!==this.tableStatus){e="top",this.base=t[i].y1;break}if(this.moveX<=t[i].x2-this.resize&&this.moveX>=t[i].x1+this.resize&&this.moveY<=t[i].y2&&this.moveY>=t[i].y2-this.resize&&"m-bottom-resize"!==this.tableStatus){e="bottom",this.base=t[i].y2;break}}e&&"left"===e||"m-left-resize"===this.tableStatus?("m-left-resize"===this.tableStatus&&(this.c.style.cursor="w-resize"),this.resizeMultipleLeft(this.base,t)):e&&"right"===e||"m-right-resize"===this.tableStatus?("m-right-resize"===this.tableStatus&&(this.c.style.cursor="e-resize"),this.resizeMultipleRight(this.base,t)):e&&"top"===e||"m-top-resize"===this.tableStatus?this.resizeMultipleTop(this.base,t):(e&&"bottom"===e||"m-bottom-resize"===this.tableStatus)&&this.resizeMultipleBottom(this.base,t)}}},{key:"resizeMultipleLeft",value:function(t,e){var i=this;"down"!==this.mouseStatus||"m-left-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-left-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.x1>t-i.resize&&e.x1<t+i.resize&&i.cellMatchList.push(e),e.x2>t-i.resize&&e.x2<t+i.resize&&i.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r,h=i.cellMatchList.findIndex((function(e){return e.key===t.key})),o=i.cellflowList.findIndex((function(e){return e.key===t.key}));-1!==h&&(r=i.getMinWidthByCellList("max",i.cellMatchList)-2*i.resize,h=i.cellMatchList[h].x1+i.moveX-i.startX<r?i.cellMatchList[h].x1+i.moveX-i.startX:r,0<i.cellflowList.length&&(h=h<(r=i.getMinWidthByCellList("min",i.cellflowList)+2*i.resize)?r:h),i.layers[e]=s(s({},t),{},{x1:h,location:i.getCellLocation("move",s(s({},t),{},{x1:h}))})),-1!==o&&(r=i.getMinWidthByCellList("min",i.cellflowList)+2*i.resize,h=i.getMinWidthByCellList("max",i.cellMatchList)-2*i.resize,o=(o=i.cellflowList[o].x2+i.moveX-i.startX>r?i.cellflowList[o].x2+i.moveX-i.startX:r)<h?o:h,i.layers[e]=s(s({},t),{},{x2:o,location:i.getCellLocation("move",s(s({},t),{},{x2:o}))}))})),this.isOpt="move",this.draw())}},{key:"resizeMultipleRight",value:function(t,e){var i=this;"down"!==this.mouseStatus||"m-right-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-right-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.x2>t-i.resize&&e.x2<t+i.resize&&i.cellMatchList.push(e),e.x1>t-i.resize&&e.x1<t+i.resize&&i.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r,h=i.cellMatchList.findIndex((function(e){return e.key===t.key})),o=i.cellflowList.findIndex((function(e){return e.key===t.key}));-1!==h&&(r=i.getMinWidthByCellList("min",i.cellMatchList)+2*i.resize,h=i.cellMatchList[h].x2+i.moveX-i.startX>r?i.cellMatchList[h].x2+i.moveX-i.startX:r,0<i.cellflowList.length&&(h=(r=i.getMinWidthByCellList("max",i.cellflowList)-2*i.resize)<h?r:h),i.layers[e]=s(s({},t),{},{x2:h,location:i.getCellLocation("move",s(s({},t),{},{x2:h}))})),-1!==o&&(r=i.getMinWidthByCellList("min",i.cellMatchList)+2*i.resize,h=i.getMinWidthByCellList("max",i.cellflowList)-2*i.resize,o=(o=i.cellflowList[o].x1+i.moveX-i.startX>r?i.cellflowList[o].x1+i.moveX-i.startX:r)<h?o:h,i.layers[e]=s(s({},t),{},{x1:o,location:i.getCellLocation("move",s(s({},t),{},{x1:o}))}))})),this.isOpt="move",this.draw())}},{key:"resizeMultipleTop",value:function(t,e){var i=this;this.c.style.cursor="n-resize","down"!==this.mouseStatus||"m-top-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-top-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.y1>t-i.resize&&e.y1<t+i.resize&&i.cellMatchList.push(e),e.y2>t-i.resize&&e.y2<t+i.resize&&i.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r,h=i.cellMatchList.findIndex((function(e){return e.key===t.key})),o=i.cellflowList.findIndex((function(e){return e.key===t.key}));-1!==h&&(r=i.getMinHeightByCellList("max",i.cellMatchList)-2*i.resize,h=i.cellMatchList[h].y1+i.moveY-i.startY<r?i.cellMatchList[h].y1+i.moveY-i.startY:r,0<i.cellflowList.length&&(h=h<(r=i.getMinHeightByCellList("min",i.cellflowList)+2*i.resize)?r:h),i.layers[e]=s(s({},t),{},{y1:h,location:i.getCellLocation("move",s(s({},t),{},{y1:h}))})),-1!==o&&(r=i.getMinHeightByCellList("min",i.cellflowList)+2*i.resize,o=(h=i.getMinHeightByCellList("max",i.cellMatchList)-2*i.resize)<(o=i.cellflowList[o].y2+i.moveY-i.startY>r?i.cellflowList[o].y2+i.moveY-i.startY:r)?h:o,i.layers[e]=s(s({},t),{},{y2:o,location:i.getCellLocation("move",s(s({},t),{},{y2:o}))}))})),this.isOpt="move",this.draw())}},{key:"resizeMultipleBottom",value:function(t,e){var i=this;this.c.style.cursor="s-resize","down"!==this.mouseStatus||"m-bottom-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-bottom-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.y2>t-i.resize&&e.y2<t+i.resize&&i.cellMatchList.push(e),e.y1>t-i.resize&&e.y1<t+i.resize&&i.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r,h=i.cellMatchList.findIndex((function(e){return e.key===t.key})),o=i.cellflowList.findIndex((function(e){return e.key===t.key}));-1!==h&&(r=i.getMinHeightByCellList("min",i.cellMatchList)+2*i.resize,h=i.cellMatchList[h].y2+i.moveY-i.startY>r?i.cellMatchList[h].y2+i.moveY-i.startY:r,0<i.cellflowList.length&&(h=(r=i.getMinHeightByCellList("max",i.cellflowList)-2*i.resize)<h?r:h),i.layers[e]=s(s({},t),{},{y2:h,location:i.getCellLocation("move",s(s({},t),{},{y2:h}))})),-1!==o&&(r=i.getMinHeightByCellList("min",i.cellMatchList)+2*i.resize,o=(h=i.getMinHeightByCellList("max",i.cellflowList)-2*i.resize)<(o=i.cellflowList[o].y1+i.moveY-i.startY>r?i.cellflowList[o].y1+i.moveY-i.startY:r)?h:o,i.layers[e]=s(s({},t),{},{y1:o,location:i.getCellLocation("move",s(s({},t),{},{y1:o}))}))})),this.isOpt="move",this.draw())}},{key:"getMinWidthByCellList",value:function(t,e){var i=e[0].x1,s=e[0].x2;return e.forEach((function(t){t.x2<s&&(s=t.x2),t.x1>i&&(i=t.x1)})),t?"min"===t?i:s:{min:i,max:s}}},{key:"getMinHeightByCellList",value:function(t,e){var i=e[0].y1,s=e[0].y2;return e.forEach((function(t){t.y2<s&&(s=t.xy),t.y1>i&&(i=t.y1)})),t?"min"===t?i:s:{min:i,max:s}}},{key:"drawImage",value:function(){var t=this;this.img.src=this.config.url,this.img.key=new Date,this.img.onload=function(){var e=t.img.width/t.c.width,i=t.img.height/t.c.height,s=i<e?e:i;t.imgRate=1<s?1/s:i<e?(t.c.width-40)/t.img.width:(t.c.height-40)/t.img.height,t.layers.push(t.getImgCoord()),t.drawOriginData(),t.draw()}}},{key:"drawOriginData",value:function(){var t,e,i,s=this;this.config.defaultData&&0<this.config.defaultData.length&&(e=(null==(t=this.layers[0])?void 0:t.x1)||0,i=(null==(t=this.layers[0])?void 0:t.y1)||0,this.config.defaultData.forEach((function(t){0<(t=t.location).length&&s.layers.push({x1:t[0][0]*s.imgRate+e,y1:t[0][1]*s.imgRate+i,x2:t[1][0]*s.imgRate+e,y2:t[2][1]*s.imgRate+i,strokeStyle:s.drawSelectColor,location:t,type:"cell",w:1,h:1,key:(new Date).getTime()+"cell"+t[0][0]+e+t[0][1]+i})})),this.draw())}},{key:"getImgCoord",value:function(){var t=this.img.width*this.imgRate,e=this.img.height*this.imgRate+20,i=0;return t<this.c.width&&(i=(this.c.width-t)/2),t>this.c.width&&(this.c.width=t),e>this.c.height&&(this.c.height=e),t<this.c.width&&e<this.c.height&&(this.c.width=t>document.body.clientWidth?t:document.body.clientWidth,this.c.height=e>document.body.clientHeight-64?e:document.body.clientHeight-64),{type:"img",x1:i,x2:i+t,y1:20,y2:e,isOpt:!1,key:(new Date).getTime()+"img"+i+0}}},{key:"draw",value:function(){var t=this,e=(this.ctx.clearRect(0,0,this.c.width,this.c.height),[]);this.layers.forEach((function(i){if(t.ctx.beginPath(),t.ctx.setLineDash([]),t.ctx.lineWidth=1,"img"===i.type)t.ctx.drawImage(t.img,i.x1,i.y1,i.x2-i.x1,i.y2-i.y1);else if("cell"===i.type||"select"===i.type)t.current&&t.current.key===i.key||0<t.currentArray.length&&-1!==t.currentArray.findIndex((function(t){return t.key===i.key}))?e.push(i):(i.strokeStyle=t.drawSelectColor,t.ctx.rect(i.x1,i.y1,i.x2-i.x1,i.y2-i.y1));else if("table"===i.type){t.current&&t.current.key===i.key?(i.strokeStyle=t.selectActiveColor,i.lineWidth=2):i.strokeStyle=t.drawSelectColor,0<t.currentArray.length&&t.current&&"select"===t.current.type&&-1!==t.currentArray.findIndex((function(t){return t.key===i.key}))&&(i.strokeStyle=t.selectActiveColor,i.lineWidth=2);for(var s=0;s<=i.h;s++)t.ctx.moveTo(i.coord.tr[s].x1,i.coord.tr[s].y1),t.ctx.lineTo(i.coord.tr[s].x2,i.coord.tr[s].y2);for(var r=0;r<=i.w;r++)t.ctx.moveTo(i.coord.td[r].x1,i.coord.td[r].y1),t.ctx.lineTo(i.coord.td[r].x2,i.coord.td[r].y2)}t.ctx.strokeStyle=i.strokeStyle,t.ctx.lineWidth=i.lineWidth||1,t.ctx.stroke()})),e.forEach((function(e){t.ctx.beginPath(),t.ctx.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),t.ctx.strokeStyle=t.selectActiveColor,t.ctx.lineWidth=2,t.ctx.stroke()}))}},{key:"getScroll",value:function(){return{top:this.ctx.parent.scrollTop,left:this.ctx.parent.scrollLeft}}},{key:"zoom",value:function(t){var e,i=this;if("up"===t)this.imgRate+=.1;else if(this.imgRate<=.2){if(this.imgRate<=.02)return;this.imgRate-=.01}else this.imgRate-=.1;this.Recalculate(),this.current&&(t=this.layers.findIndex((function(t){return t.key===i.current.key})),this.current=s({index:t},this.layers[t])),0<this.currentArray.length&&(e=[],this.layers.forEach((function(t){-1!==i.currentArray.findIndex((function(e){return e.key===t.key}))&&e.push(t)})),this.currentArray=[].concat(e))}},{key:"Recalculate",value:function(){var t=this,e=0,i=0;"image"===this.layers[0].type&&(this.layers[0]=this.getImgCoord(),e=this.layers[0].x1,i=this.layers[0].y1),this.layers.forEach((function(s){var r,h;"img"!==s.type&&s.location&&(s.x1=s.location[0][0]*t.imgRate+e,s.y1=s.location[0][1]*t.imgRate+i,s.x2=s.location[1][0]*t.imgRate+e,s.y2=s.location[2][1]*t.imgRate+i,"table"===s.type&&(r=[],h=[],s.coordLocation.td.forEach((function(s){r.push({x1:s.x1*t.imgRate+e,x2:s.x2*t.imgRate+e,y1:s.y1*t.imgRate+i,y2:s.y2*t.imgRate+i})})),s.coordLocation.tr.forEach((function(s){h.push({x1:s.x1*t.imgRate+e,x2:s.x2*t.imgRate+e,y1:s.y1*t.imgRate+i,y2:s.y2*t.imgRate+i})})),s.coord={td:r,tr:h}))})),this.draw()}},{key:"isPointInRetc",value:function(t,e){for(var i=0;i<this.layers.length;i++)if(("table"===this.layers[i].type||"cell"===this.layers[i].type||"select"===this.layers[i].type)&&this.layers[i].x1<=t&&t<=this.layers[i].x2&&this.layers[i].y1<=e&&e<=this.layers[i].y2)return s(s({},this.layers[i]),{},{index:i})}},{key:"windowToCanvas",value:function(t,e){var i=this.c.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"reSizeTable",value:function(){if(this.moveX>=this.current.x1&&this.moveX<=this.current.x1+this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y2||"left-resize"===this.tableStatus)this.resizeLeft();else if(this.moveX<=this.current.x2&&this.moveX>=this.current.x2-this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y2||"right-resize"===this.tableStatus)this.resizeRight();else if(this.moveY>=this.current.y1&&this.moveY<=this.current.y1+this.resize&&this.moveX>=this.current.x1+this.resize&&this.moveX<=this.current.x2-this.resize||"top-resize"===this.tableStatus)this.resizeTop();else if(this.moveY>=this.current.y2-this.resize&&this.moveY<this.current.y2&&this.moveX>=this.current.x1+this.resize&&this.moveX<this.current.x2-this.resize||"bottom-resize"===this.tableStatus)this.resizeBottom();else if(this.moveX>=this.current.x1&&this.moveX<=this.current.x1+this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y1+this.resize||"lt-resize"===this.tableStatus)this.resizeLT();else if(this.moveX<=this.current.x2&&this.moveX>=this.current.x2-this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y1+this.resize||"rt-resize"===this.tableStatus)this.resizeRT();else if(this.moveX>=this.current.x1&&this.moveX<=this.current.x1+this.resize&&this.moveY<=this.current.y2&&this.moveY>=this.current.y2-this.resize||"lb-resize"===this.tableStatus)this.resizeBL();else if(this.moveX<=this.current.x2&&this.moveX>=this.current.x2-this.resize&&this.moveY<=this.current.y2&&this.moveY>=this.current.y2-this.resize||"rb-resize"===this.tableStatus)this.resizeBR();else if("table"===this.current.type&&this.moveX>this.current.x1+this.resize&&this.moveX<this.current.x2-this.resize&&this.moveY>this.current.y1+this.resize&&this.moveY<this.current.y2-this.resize){for(var t=r(this.current.coord.td),e=r(this.current.coord.tr),i=!1,s=1;s<e.length-1;s++)if(this.moveY>e[s].y1-this.resize&&this.moveY<e[s].y1+this.resize&&"table-resize"!==this.tableStatus){i=!0,this.match.type="tr",this.match.index=s,this.c.style.cursor="n-resize";break}for(var h=1;h<t.length-1;h++)if(this.moveX>t[h].x1-this.resize&&this.moveX<t[h].x1+this.resize&&"table-resize"!==this.tableStatus){i=!0,this.match.type="td",this.match.index=h,this.c.style.cursor="w-resize";break}!i&&"table-resize"!==this.tableStatus||"down"!==this.mouseStatus||this.resizeTableLine(this.match)}}},{key:"movetable",value:function(){var t,e,i,r,h,o=this;this.tableStatus&&"moving"!==this.tableStatus||(this.tableStatus="moving",this.current?(t=this.moveX-this.leftDistance-this.current.x1,e=this.moveY-this.topDistance-this.current.y1,this.current.x2+=t,this.current.x1+=t,this.current.y2+=e,this.current.y1+=e,"table"===this.current.type?(i=[],r=[],this.current.coord.tr.forEach((function(s){i.push({x1:s.x1+t,y1:s.y1+e,x2:s.x2+t,y2:s.y2+e})})),this.current.coord.td.forEach((function(i){r.push({x1:i.x1+t,y1:i.y1+e,x2:i.x2+t,y2:i.y2+e})})),this.current.coord={tr:i,td:r}):"select"===this.current.type&&0<this.currentArray.length&&this.layers.forEach((function(i,s){o.currentArray.forEach((function(r){var h,a;r.key===i.key&&(o.layers[s].x2+=t,o.layers[s].x1+=t,o.layers[s].y2+=e,o.layers[s].y1+=e,o.layers[s].location=o.getCellLocation("move",i),"table"===i.type&&(h=[],a=[],i.coord.tr.forEach((function(i){h.push({x1:i.x1+t,y1:i.y1+e,x2:i.x2+t,y2:i.y2+e})})),i.coord.td.forEach((function(i){a.push({x1:i.x1+t,y1:i.y1+e,x2:i.x2+t,y2:i.y2+e})})),o.layers[s].coord={td:a,tr:h},o.layers[s].coordLocation=o.getTableLocation("move",i)))}))})),this.dealData("move")):0<this.currentArray.length&&(h="",this.currentArray.forEach((function(t){h=t.index||o.layers.findIndex((function(e){return e.key===t.key})),o.layers[h]=s(s({},o.layers[h]),{},{x1:t.x1+o.moveX-o.startX,x2:t.x2+o.moveX-o.startX,y1:t.y1+o.moveY-o.startY,y2:t.y2+o.moveY-o.startY}),o.layers[h].location=o.getCellLocation("move",o.layers[h])})),this.isOpt="move",this.draw()))}},{key:"resizeLeft",value:function(){var t,e,i=this;this.c.style.cursor="w-resize","down"===this.mouseStatus&&"lt-resize"!==this.tableStatus&&"lb-resize"!==this.tableStatus&&(this.tableStatus="left-resize",this.current.x1=this.moveX>this.current.x2-this.resize?this.current.x2-this.resize:this.moveX,"table"===this.current.type&&(t=[],e=r(this.current.coord.td),this.current.coord.tr.forEach((function(s){t.push({x1:i.moveX>e[1].x1-i.resize?e[1].x1-i.resize:i.moveX,y1:s.y1,x2:s.x2,y2:s.y2})})),e[0].x1=this.moveX>e[1].x1-this.resize?e[1].x1-this.resize:this.moveX,e[0].x2=this.moveX>e[1].x1-this.resize?e[1].x1-this.resize:this.moveX,this.current.coord={tr:t,td:e}),this.dealData())}},{key:"resizeRight",value:function(){var t,e,i=this;this.c.style.cursor="e-resize","down"===this.mouseStatus&&"rt-resize"!==this.tableStatus&&"rb-resize"!==this.tableStatus&&(this.tableStatus="right-resize",this.current.x2=this.moveX<this.current.x1+this.resize?this.current.x1+this.resize:this.moveX,"table"===this.current.type&&(t=[],e=[],e=r(this.current.coord.td),this.current.coord.tr.forEach((function(s){t.push({x1:s.x1,y1:s.y1,x2:i.moveX>e[e.length-2].x2+i.resize?i.moveX:e[e.length-2].x2+i.resize,y2:s.y2})})),e[e.length-1].x1=this.moveX>e[e.length-2].x2+this.resize?this.moveX:e[e.length-2].x1+this.resize,e[e.length-1].x2=this.moveX>e[e.length-2].x2+this.resize?this.moveX:e[e.length-2].x1+this.resize,this.current.coord={tr:t,td:e}),this.dealData())}},{key:"resizeTop",value:function(){var t,e,i=this;this.c.style.cursor="n-resize","down"===this.mouseStatus&&"lt-resize"!==this.tableStatus&&"rt-resize"!==this.tableStatus&&(this.tableStatus="top-resize",this.current.y1=this.moveY>this.current.y2-this.resize?this.current.y2-this.resize:this.moveY,"table"===this.current.type&&(e=[],t=[],e=r(this.current.coord.tr),this.current.coord.td.forEach((function(s){t.push({x1:s.x1,y1:i.moveY>e[1].y1-i.resize?e[1].y1-i.resize:i.moveY,x2:s.x2,y2:s.y2})})),e[0].y1=this.moveY>e[1].y1-this.resize?e[1].y1-this.resize:this.moveY,e[0].y2=this.moveY>e[1].y1-this.resize?e[1].y1-this.resize:this.moveY,this.current.coord={tr:e,td:t}),this.dealData())}},{key:"resizeBottom",value:function(){var t,e,i=this;this.c.style.cursor="s-resize","down"===this.mouseStatus&&"lb-resize"!==this.tableStatus&&"rb-resize"!==this.tableStatus&&(this.tableStatus="bottom-resize",this.current.y2=this.moveY<this.current.y1+this.resize?this.current.y1+this.resize:this.moveY,"table"===this.current.type&&(e=[],t=[],e=r(this.current.coord.tr),this.current.coord.td.forEach((function(s){t.push({x1:s.x1,y1:s.y1,x2:s.x2,y2:i.moveY>e[e.length-2].y2+i.resize?i.moveY:e[e.length-2].y2+i.resize})})),e[e.length-1].y1=this.moveY>e[e.length-2].y2+this.resize?this.moveY:e[e.length-2].y2+this.resize,e[e.length-1].y2=this.moveY>e[e.length-2].y2+this.resize?this.moveY:e[e.length-2].y2+this.resize,this.current.coord={tr:e,td:t}),this.dealData())}},{key:"resizeLT",value:function(){var t,e,i,s=this;this.c.style.cursor="nw-resize","down"===this.mouseStatus&&(this.tableStatus="lt-resize",t=this.moveY-this.current.y1,this.current.x1=this.moveX,this.current.y1=this.moveY,"table"===this.current.type&&(e=[],i=[],this.current.coord.tr.forEach((function(t){e.push({x1:s.moveX>s.current.coord.td[1].x1-s.resize?s.current.coord.td[1].x1-s.resize:s.moveX,y1:t.y1,x2:t.x2,y2:t.y2})})),e[0].y1+=t,e[0].y2+=t,this.current.coord.td.forEach((function(e){i.push({x1:e.x1,y1:e.y1+t,x2:e.x2,y2:e.y2})})),i[0].x1=this.moveX>i[1].x1-this.resize?i[1].x1-this.resize:this.moveX,i[0].x2=this.moveX>i[1].x1-this.resize?i[1].x1-this.resize:this.moveX,this.current.coord={tr:e,td:i}),this.dealData())}},{key:"resizeRT",value:function(){var t,e,i,s=this;this.c.style.cursor="ne-resize","down"===this.mouseStatus&&(this.tableStatus="rt-resize",t=this.moveY-this.current.y1,this.current.x2=this.moveX,this.current.y1=this.moveY,"table"===this.current.type&&(e=[],i=[],this.current.coord.tr.forEach((function(t){e.push({x1:t.x1,y1:t.y1,x2:s.moveX,y2:t.y2})})),e[0].y1+=t,e[0].y2+=t,this.current.coord.td.forEach((function(e){i.push({x1:e.x1,y1:e.y1+t,x2:e.x2,y2:e.y2})})),i[i.length-1].x1=this.moveX,i[i.length-1].x2=this.moveX,this.current.coord={tr:e,td:i}),this.dealData())}},{key:"resizeBL",value:function(){var t,e,i,s=this;this.c.style.cursor="sw-resize","down"===this.mouseStatus&&(this.tableStatus="lb-resize",t=this.moveY-this.current.y2,this.current.x1=this.moveX,this.current.y2=this.moveY,"table"===this.current.type&&(e=[],i=[],this.current.coord.tr.forEach((function(t){e.push({x1:s.moveX,y1:t.y1,x2:t.x2,y2:t.y2})})),e[e.length-1].y1+=t,e[e.length-1].y2+=t,this.current.coord.td.forEach((function(e){i.push({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2+t})})),i[0].x1=this.moveX,i[0].x2=this.moveX,this.current.coord={tr:e,td:i}),this.dealData())}},{key:"resizeBR",value:function(){var t,e,i,s=this;this.c.style.cursor="se-resize","down"===this.mouseStatus&&(this.tableStatus="rb-resize",t=this.moveY-this.current.y2,this.current.x2=this.moveX,this.current.y2=this.moveY,"table"===this.current.type&&(e=[],i=[],this.current.coord.tr.forEach((function(t){e.push({x1:t.x1,y1:t.y1,x2:s.moveX,y2:t.y2})})),e[e.length-1].y1+=t,e[e.length-1].y2+=t,this.current.coord.td.forEach((function(e){i.push({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2+t})})),i[i.length-1].x1=this.moveX,i[i.length-1].x2=this.moveX,this.current.coord={tr:e,td:i}),this.dealData())}},{key:"resizeTableLine",value:function(t){var e,i,h,o=r(this.current.coord.td),a=r(this.current.coord.tr);this.tableStatus="table-resize","td"===t.type?(e=Object.assign({},o[t.index]),i=o[t.index-1].x1+3*this.resize,h=o[t.index+1].x1-3*this.resize,o[t.index]=s(s({},e),{},{x1:this.moveX<i?i:this.moveX>h?h:this.moveX,x2:this.moveX<i?i:this.moveX>h?h:this.moveX})):(e=Object.assign({},a[t.index]),i=a[t.index-1].y1+3*this.resize,h=a[t.index+1].y1-3*this.resize,a[t.index]=s(s({},e),{},{y1:this.moveY<i?i:this.moveY>h?h:this.moveY,y2:this.moveY<i?i:this.moveY>h?h:this.moveY})),this.current.coord={td:o,tr:a},this.dealData()}},{key:"dealData",value:function(t){var e=this;this.isOpt=t||"resize",this.current.location=this.getCellLocation("move",this.current),"table"===this.current.type&&(this.current.coordLocation=this.getTableLocation("move",this.current)),t=0,t=this.current.index||this.layers.findIndex((function(t){return t.key===e.current.key})),this.layers[t]=this.current,this.draw()}},{key:"getCellLocation",value:function(t,e){var i=0,s=0,r=("iamge"===this.layers[0].type&&(i=this.layers[0].x1,s=this.layers[0].y1),(("draw"===t?this.startX:e.x1)-i)/this.imgRate),h=(("draw"===t?this.startY:e.y1)-s)/this.imgRate;return[[r,h],[i=(("draw"===t?this.moveX:e.x2)-i)/this.imgRate,h],[r,t=(("draw"===t?this.moveY:e.y2)-s)/this.imgRate],[i,t]]}},{key:"getTableLocation",value:function(t,e){var i=this,s=0,r=0,h=("iamge"===this.layers[0].type&&(s=this.layers[0].x1,r=this.layers[0].y1),[]),o=[];return(t=("draw"===t?this:e).coord).tr.forEach((function(t){o.push({x1:(t.x1-s)/i.imgRate,y1:(t.y1-r)/i.imgRate,x2:(t.x2-s)/i.imgRate,y2:(t.y2-r)/i.imgRate})})),t.td.forEach((function(t){h.push({x1:(t.x1-s)/i.imgRate,y1:(t.y1-r)/i.imgRate,x2:(t.x2-s)/i.imgRate,y2:(t.y2-r)/i.imgRate})})),{tr:o,td:h}}},{key:"revoke",value:function(){var t,e,i,s=this;1<=this.history.length&&("move"===(t=this.history.pop()).type||"resize"===t.type?t.selectOpt?this.layers.forEach((function(e,i){t.originData.forEach((function(t){t.key===e.key&&(s.layers[i]=t)}))})):(i=this.layers.findIndex((function(e){return e.key===t.data.key})),this.layers[i]=t.originData):"delete"===t.type?t.selectOpt?this.layers=this.layers.concat(t.originData):this.layers.push(t.originData):"draw"===t.type&&(t.data instanceof Array?(e=[],this.layers.forEach((function(i){var s=!1;t.data.forEach((function(t){i.key===t.key&&(s=!0)})),s||e.push(i)})),this.layers=[].concat(e),t.originData=r(t.data)):(i=this.layers.findIndex((function(e){return e.key===t.data.key})),t.originData=this.layers[i],this.layers.splice(i,1))),this.deleteHistory.push(t),this.draw())}},{key:"reRevoke",value:function(){var t,e,i,r=this;0<this.deleteHistory.length&&("move"===(t=this.deleteHistory.pop()).type||"resize"===t.type?t.selectOpt?this.layers.forEach((function(e,i){t.data.forEach((function(t){t.key===e.key&&(r.layers[i]=t)}))})):(i=this.layers.findIndex((function(e){return e.key===t.data.key})),this.layers[i]=s({},t.data)):"delete"===t.type?t.selectOpt?(e=[],this.layers.forEach((function(i){var s=!1;t.originData.forEach((function(t){t.key===i.key&&(s=!0)})),s||e.push(i)})),this.layers=e):(i=this.layers.findIndex((function(e){return e.key===t.originData.key})),this.layers.splice(i,1)):"draw"===t.type&&(t.originData instanceof Array?this.layers=this.layers.concat(t.originData):this.layers.push(t.originData)),this.history.push(t),this.draw())}},{key:"delete",value:function(){var t,e,i,s,r,h=this;this.current?("select"===this.current.type?(t=[],e=[],this.layers.forEach((function(i){var s=!1;h.currentArray.forEach((function(t){i.key===t.key&&(s=!0)})),(s?e:t).push(i)})),this.history.push({type:"delete",selectOpt:!0,data:"",originData:[].concat(e)}),this.layers=t):(this.history.push({type:"delete",data:"",originData:this.current}),i=this.layers.findIndex((function(t){return t.key===h.current.key})),this.layers.splice(i,1)),this.noUpdate=this.checkIsSave(),this.current=null,this.draw(),this.c.style.cursor="default"):0<this.currentArray.length&&(s=[],r=[],this.layers.forEach((function(t){(-1===h.currentArray.findIndex((function(e){return e.key===t.key}))?s:r).push(t)})),this.history.push({type:"delete",selectOpt:!0,data:[],originData:[].concat(r)}),this.layers=[].concat(s),this.currentArray=[],this.noUpdate=this.checkIsSave(),this.draw(),this.c.style.cursor="default")}},{key:"removeSelect",value:function(){var t=this.layers.findIndex((function(t){return"select"===t.type}));-1!==t&&this.layers.splice(t,1)}},{key:"fixPosition",value:function(t){var e;return t.x1>t.x2&&(e=t.x1,t.x1=t.x2,t.x2=e),t.y1>t.y2&&(e=t.y1,t.y1=t.y2,t.y2=e),t}},{key:"findSelectArray",value:function(t){var e=this;this.currentArray=[],this.layers.forEach((function(i){i.x1>=t.x1&&i.x2<=t.x2&&i.y1>=t.y1&&i.y2<=t.y2&&"select"!==i.type&&"img"!==i.type&&e.currentArray.push(s({},i))}))}},{key:"saveDraw",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",i=[],h=0,o=0,a=("iamge"===this.layers[0].type&&(h=this.layers[0].x1,o=this.layers[0].y1),{});this.layers.forEach((function(e){var a,n,l,c;"cell"===e.type?(c=parseInt((e.x1-h)/t.imgRate),a=parseInt((e.y1-o)/t.imgRate),n=parseInt((e.x2-h)/t.imgRate),l=parseInt((e.y2-o)/t.imgRate),i.push(s(s({},e),{},{location:[[c,a],[n,a],[n,l],[c,l]],x1:c,y1:a,x2:n,y2:l}))):"table"===e.type&&(c=t.transTable(e,h,o),i.push.apply(i,r(c)))})),i.sort((function(t,e){return Number(t.y1)-Number(e.y1)}));for(var n=0;n<i.length;n++)a[i[n].y1]?a[i[n].y1].push(i[n]):a[i[n].y1]=[i[n]];var l=[];return Object.keys(a).sort((function(t,e){return t-e})).forEach((function(t){(t=a[t]).sort((function(t,e){return t.x1-e.x1})),l.push.apply(l,r(t))})),e||(this.saveCurrent=[].concat(l),this.history=[],this.deleteHistory=[],this.current=null,this.noUpdate=!0),l}},{key:"transTable",value:function(t,e,i){for(var r=t.coord.td,h=t.coord.tr,o=[],a=0;a<t.w;a++)for(var n=0;n<t.h;n++){var l=parseInt((r[a].x1-e)/this.imgRate),c=parseInt((h[n].y1-i)/this.imgRate),u=parseInt((r[a+1].x1-e)/this.imgRate),y=parseInt((h[n+1].y1-i)/this.imgRate);o.push(s(s({},t),{},{location:[[l,c],[u,c],[u,y],[l,y]],x1:l,y1:c,x2:u,y2:y}))}return o}},{key:"setMode",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{type:"cell",tr:1,td:1};this.mode=t||"select","draw"===t?(this.c.style.cursor="crosshair",this.drawType=e,this.current=null,this.currentArray=[]):(this.draw.drawType={},"drawSelect"===t&&(this.c.style.cursor="crosshair",this.current=null,this.currentArray=[])),this.draw()}},{key:"resetConfig",value:function(t){this.config=Object.assign(this.config,t),this.layers=[],this.current=null,this.imgRate=1,this.history=[],this.noUpdate=!0,this.deleteHistory=[],this.currentArray=[],this.saveCurrent=[],this.c.width=document.body.clientWidth,this.c.height=document.body.clientHeight-64,this.mode="select",this.config.url?this.drawImage():this.drawOriginData()}},{key:"checkIsSave",value:function(){var t=!0,e=this.saveDraw("check");if(this.saveCurrent.length===e.length)for(var i=0;i<this.saveCurrent.length;i++)this.saveCurrent[i].x1===e[i].x1&&this.saveCurrent[i].x2===e[i].x2&&this.saveCurrent[i].y1===e[i].y1&&this.saveCurrent[i].y2===e[i].y2||(t=!1);else t=!1;return t}}])&&function(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();return e.default=(a=null,function(t,e){return a?a.resetConfig({}):a=new n(t,e),a}),e}));