!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.$DrawTable=e():t.$DrawTable=e()}(self,(function(){return function(){"use strict";var t={};function e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function i(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}(function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var n,l=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.mode="select",this.drawType={type:"cell",td:1,tr:1},this.startX=0,this.startY=0,this.moveX=0,this.moveY=0,this.leftDistance=0,this.topDistance=0,this.c=null,this.ctx=null,this.resize=6,this.mouseStatus=null,this.tableStatus=null,this.layers=[],this.history=[],this.deleteHistory=[],this.isOpt="",this.originCurrent=null,this.current=null,this.coord=null,this.currentArray=[],this.currentArrayItem=null,this.base=0,this.scrollRateY=20,this.scrollRateX=20,this.timerX=null,this.timerY=null,this.timerTop=null,this.cellMatchList=[],this.cellflowList=[],this.clientY=0,this.clientX=0,this.match={type:"",index:0},this.noUpdate=!0,this.saveCurrent=[],this.imgRate=1,this.img=new Image,this.modeChange=i,this.tempy=0,this.selectColor=e.selectColor||"#666",this.selectActiveColor=e.selectActiveColor||"red",this.drawSelectColor=e.drawSelectColor||"#0099CC",this.init()}var e,s;return e=t,s=[{key:"init",value:function(){"object"===o(this.config.dom)&&"nodeType"in this.config.dom?this.c=this.config.dom:this.c=document.getElementById(this.config.dom),this.ctx=this.c.getContext("2d"),this.c.width=document.body.clientWidth,this.c.height=document.body.clientHeight-64,this.addMouseEvent(),this.config.url?this.drawImage():this.drawOriginData(),this.addKeyboard()}},{key:"addMouseEvent",value:function(){this.c.onmousedown=this.mousedown.bind(this),this.c.onmousemove=this.mousemove.bind(this),this.c.onmouseup=this.mouseup.bind(this)}},{key:"mousedown",value:function(t){var e=this.windowToCanvas(t.clientX,t.clientY);switch(this.startX=e.x,this.startY=e.y,this.mouseStatus="down",this.mode){case"select":this.originCurrent=this.isPointInRetc(e.x,e.y);break;case"drawSelect":var i=this.layers.findIndex((function(t){return"select"===t.type}));-1!==i&&this.layers.splice(i,1);break;case"move":if(this.current){var s=this.isPointInRetc(e.x,e.y);this.originCurrent=s,s?(this.leftDistance=e.x-s.x1,this.topDistance=e.y-s.y1):(this.mode="select",this.current.type,this.current=null)}else if(this.currentArray.length>0){var h=this.isPointInRetc(e.x,e.y);this.originCurrent=r(this.currentArray),h?this.currentArrayItem=h:(this.mode="select",this.current=null,this.currentArray=[])}break;case"draw":this.originCurrent=null}}},{key:"addKeyboard",value:function(){var t=this;document.addEventListener("keydown",(function(e){e.key&&("delete"===e.key.toString().toLowerCase()&&t.delete(),(e.metaKey&&"z"===e.key.toString().toLowerCase()||e.ctrlKey&&"z"===e.key.toString().toLowerCase())&&t.history.length>0&&t.revoke(),(e.metaKey&&"s"===e.key.toString().toLowerCase()||e.ctrlKey&&"s"===e.key.toString().toLowerCase())&&(t.noUpdate||t.saveDraw()),e.ctrlKey&&"="===e.key&&t.zoom("up"),e.ctrlKey&&"-"===e.key&&t.zoom("down"))}))}},{key:"mouseup",value:function(t){var e=this;t.preventDefault(),this.clearTimer();var s=this.windowToCanvas(t.clientX,t.clientY);this.mouseStatus="up",this.tableStatus="";var h={},o=[];if(this.match={type:"",index:0},"select"===this.mode||"move"===this.mode){if(this.isOpt){if("move"===this.isOpt&&this.currentArray.length>0){var a=[];this.layers.forEach((function(t){-1!==e.currentArray.findIndex((function(e){return e.key===t.key}))&&a.push(t)})),this.currentArray=[].concat(a),this.current=null,this.base=0,this.cellMatchList=[],this.cellflowList=[]}}else if(!this.current||"select"!==this.current.type){var n=this.isPointInRetc(s.x,s.y);if(n){if(t.ctrlKey){var l=this.currentArray.findIndex((function(t){return t.key===n.key}));-1!==l?this.currentArray.splice(l,1):this.currentArray.push(n)}else this.current=n,this.currentArray=[];this.c.style.cursor="move"}else this.c.style.cursor="default"}this.current?this.mode="move":this.current=null,this.draw()}else if("draw"===this.mode&&"draw"===this.isOpt){if(Math.abs(this.moveX-this.startX)>2*this.resize&&Math.abs(this.moveY-this.startY)>2*this.resize){var c="drawSelect"===this.mode?"select":this.drawType.type;if("table"===c){for(var u=this.drawType.td,y=this.drawType.tr,m=this.moveX-this.startX,v=this.moveY-this.startY,f=0;f<u;f++)for(var d=0;d<y;d++){var x=this.startX+m/u*f,p=this.startX+m/u*(f+1),g=this.startY+v/y*d,z=this.startY+v/y*(d+1),b=this.fixPosition({x1:x,y1:g,x2:p,y2:z,type:"cell",key:(new Date).getTime()+"cell"+x+g,location:this.getCellLocation("",{x1:x,x2:p,y1:g,y2:z})});o.push(b),this.layers.push(b)}this.c.style.cursor="default",this.currentArray=o}else{var w=(new Date).getTime()+("drawSelect"===this.mode?"select":this.drawType.type)+this.startX+this.startY;h=this.fixPosition({x1:this.startX,y1:this.startY,x2:this.moveX,y2:this.moveY,type:c,key:w,coord:this.coord,h:this.drawType.tr,w:this.drawType.td,location:this.getCellLocation("draw"),coordLocation:"table"===this.drawType.type?this.getTableLocation("draw"):{}}),this.layers.push(h),this.current=h}this.mode="move",this.c.style.cursor="default",this.modeChange("select")}else this.isOpt="";this.draw()}else if("drawSelect"===this.mode){var k=(new Date).getTime()+("drawSelect"===this.mode?"select":this.drawType.type)+this.startX+this.startY;this.findSelectArray(this.fixPosition({x1:this.startX,y1:this.startY,x2:this.moveX,y2:this.moveY,type:"select",key:k,location:this.getCellLocation("draw")})),this.isOpt="",this.mode="move",this.c.style.cursor="default",this.current=null,this.modeChange("select"),this.draw()}if(this.isOpt&&"drawSelect"!==this.mode){if(this.current&&"select"===this.current.type&&0===this.currentArray.length)return;if(this.noUpdate=this.checkIsSave(),this.history.length>=this.config.historyCount&&this.history.shift(),this.current&&"select"===this.current.type){var X=[];this.layers.forEach((function(t){e.currentArray.forEach((function(e){t.key===e.key&&X.push(i({},t))}))})),this.history.push({type:this.isOpt,data:X,originData:r(this.currentArray),selectOpt:!0}),this.deleteHistory=[],this.currentArray=X}else{if(this.currentArray.length>0)this.history.push({type:this.isOpt,data:r(this.currentArray),originData:this.originCurrent?r(this.originCurrent):null,selectOpt:!0});else{var Y=this.current||Y;this.history.push({type:this.isOpt,data:i({},Y),originData:i({},this.originCurrent)})}this.deleteHistory=[]}this.isOpt=""}}},{key:"mousemove",value:function(t){var e=this;t.preventDefault();var i=this.windowToCanvas(t.clientX,t.clientY);if(this.moveX=i.x,this.moveY=i.y,"down"===this.mouseStatus&&"select"!==this.mode){var s=this.c.parentElement,r=s.clientHeight,h=s.clientWidth,o=this.c.height-r,a=this.c.width-h;i.y-s.scrollTop>=s.clientHeight-2?(clearInterval(this.timerY),this.timerY=setInterval((function(){e.scrollRateY>=o&&(clearInterval(e.timerY),e.timerY=null),t.clientY-e.tempy<-1?(clearInterval(e.timerY),e.timerY=null):e.tempy=t.clientY,s.scrollTop+=e.scrollRateY/2}),60)):(clearInterval(this.timerY),this.scrollRateY=20),t.clientX>h-2?(clearInterval(this.timerX),this.timerX=setInterval((function(){e.scrollRateX>=a&&(clearInterval(e.timerX),e.timerX=null),s.scrollLeft+=e.scrollRateX/2}),60)):(clearInterval(this.timerX),this.scrollRateX=20);var n=s.scrollTop;n>0&&t.clientY<80?(clearInterval(this.timerTop),this.timerTop=setInterval((function(){n<=0&&(clearInterval(e.timerTop),e.timerTop=null),s.scrollTop-=e.scrollRateY/2}),60)):(clearInterval(this.timerTop),this.scrollRateY=20)}if("move"===this.mode&&(this.current?(this.current.x1+this.resize<=this.moveX&&this.current.x2-this.resize>=this.moveX&&this.current.y1+this.resize<=this.moveY&&this.current.y2-this.resize>=this.moveY||"moving"===this.tableStatus?(this.c.style.cursor="move","down"===this.mouseStatus&&this.movetable()):this.c.style.cursor="default","select"!==this.current.type&&this.reSizeTable()):this.currentArray.length>0&&(this.checkMultiple()?(this.c.style.cursor="move","down"===this.mouseStatus&&this.movetable()):this.c.style.cursor="default",this.resizeMultipleCell())),"draw"===this.mode&&"down"===this.mouseStatus||"drawSelect"===this.mode&&"down"===this.mouseStatus){if(this.ctx.save(),this.ctx.beginPath(),this.draw(),this.ctx.setLineDash([5]),this.c.style.cursor="crosshair","drawSelect"===this.mode)this.ctx.strokeStyle=this.selectColor,this.ctx.rect(this.startX,this.startY,this.moveX-this.startX,this.moveY-this.startY);else{this.coord={tr:[],td:[]};for(var l=0;l<=this.drawType.tr;l++)this.ctx.moveTo(this.startX,this.startY+l*(this.moveY-this.startY)/this.drawType.tr),this.ctx.lineTo(this.moveX,this.startY+l*(this.moveY-this.startY)/this.drawType.tr),this.coord.tr.push({x1:this.startX,y1:this.startY+l*(this.moveY-this.startY)/this.drawType.tr,x2:this.moveX,y2:this.startY+l*(this.moveY-this.startY)/this.drawType.tr});for(var c=0;c<=this.drawType.td;c++)this.ctx.moveTo(this.startX+c*(this.moveX-this.startX)/this.drawType.td,this.startY),this.ctx.lineTo(this.startX+c*(this.moveX-this.startX)/this.drawType.td,this.moveY),this.coord.td.push({x1:this.startX+c*(this.moveX-this.startX)/this.drawType.td,y1:this.startY,x2:this.startX+c*(this.moveX-this.startX)/this.drawType.td,y2:this.moveY})}this.isOpt="draw",this.ctx.stroke(),this.ctx.restore()}}},{key:"clearTimer",value:function(){clearInterval(this.timerY),clearInterval(this.timerY),clearInterval(this.timerTop),this.timerY=null,this.timerX=null,this.timerTop=null,this.scrollRateY=20,this.scrollRateX=20,this.tempy=0}},{key:"checkMultiple",value:function(){var t=this,e=!1;return this.currentArray.forEach((function(i){(i.x1+t.resize<=t.moveX&&i.x2-t.resize>=t.moveX&&i.y1+t.resize<=t.moveY&&i.y2-t.resize>=t.moveY||"moving"===t.tableStatus)&&(e=!0)})),e}},{key:"resizeMultipleCell",value:function(){if("moving"!==this.tableStatus){for(var t=r(this.currentArray),e="",i=0;i<t.length;i++){if(this.moveX>=t[i].x1&&this.moveX<=t[i].x1+this.resize&&this.moveY>=t[i].y1&&this.moveY<=t[i].y2&&"m-left-resize"!==this.tableStatus){this.moveX>=t[i].x1+1&&(this.c.style.cursor="w-resize"),e="left",this.base=t[i].x1;break}if(this.moveX<t[i].x2&&this.moveX>=t[i].x2-this.resize&&this.moveY>=t[i].y1&&this.moveY<=t[i].y2&&"m-right-resize"!==this.tableStatus){this.moveX<t[i].x2-1&&(this.c.style.cursor="e-resize"),e="right",this.base=t[i].x2;break}if(this.moveX<=t[i].x2-this.resize&&this.moveX>=t[i].x1+this.resize&&this.moveY<=t[i].y1+this.resize&&this.moveY>=t[i].y1&&"m-top-resize"!==this.tableStatus){e="top",this.base=t[i].y1;break}if(this.moveX<=t[i].x2-this.resize&&this.moveX>=t[i].x1+this.resize&&this.moveY<=t[i].y2&&this.moveY>=t[i].y2-this.resize&&"m-bottom-resize"!==this.tableStatus){e="bottom",this.base=t[i].y2;break}}e&&"left"===e||"m-left-resize"===this.tableStatus?("m-left-resize"===this.tableStatus&&(this.c.style.cursor="w-resize"),this.resizeMultipleLeft(this.base,t)):e&&"right"===e||"m-right-resize"===this.tableStatus?("m-right-resize"===this.tableStatus&&(this.c.style.cursor="e-resize"),this.resizeMultipleRight(this.base,t)):e&&"top"===e||"m-top-resize"===this.tableStatus?this.resizeMultipleTop(this.base,t):(e&&"bottom"===e||"m-bottom-resize"===this.tableStatus)&&this.resizeMultipleBottom(this.base,t)}}},{key:"resizeMultipleLeft",value:function(t,e){var s=this;"down"!==this.mouseStatus||"m-left-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-left-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.x1>t-s.resize&&e.x1<t+s.resize&&s.cellMatchList.push(e),e.x2>t-s.resize&&e.x2<t+s.resize&&s.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r=s.cellMatchList.findIndex((function(e){return e.key===t.key})),h=s.cellflowList.findIndex((function(e){return e.key===t.key}));if(-1!==r){var o=s.getMinWidthByCellList("max",s.cellMatchList)-2*s.resize,a=s.cellMatchList[r].x1+s.moveX-s.startX<o?s.cellMatchList[r].x1+s.moveX-s.startX:o;if(s.cellflowList.length>0){var n=s.getMinWidthByCellList("min",s.cellflowList)+2*s.resize;a=a<n?n:a}s.layers[e]=i(i({},t),{},{x1:a,location:s.getCellLocation("move",i(i({},t),{},{x1:a}))})}if(-1!==h){var l=s.getMinWidthByCellList("min",s.cellflowList)+2*s.resize,c=s.getMinWidthByCellList("max",s.cellMatchList)-2*s.resize,u=s.cellflowList[h].x2+s.moveX-s.startX>l?s.cellflowList[h].x2+s.moveX-s.startX:l;u=u<c?u:c,s.layers[e]=i(i({},t),{},{x2:u,location:s.getCellLocation("move",i(i({},t),{},{x2:u}))})}})),this.isOpt="move",this.draw())}},{key:"resizeMultipleRight",value:function(t,e){var s=this;"down"!==this.mouseStatus||"m-right-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-right-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.x2>t-s.resize&&e.x2<t+s.resize&&s.cellMatchList.push(e),e.x1>t-s.resize&&e.x1<t+s.resize&&s.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r=s.cellMatchList.findIndex((function(e){return e.key===t.key})),h=s.cellflowList.findIndex((function(e){return e.key===t.key}));if(-1!==r){var o=s.getMinWidthByCellList("min",s.cellMatchList)+2*s.resize,a=s.cellMatchList[r].x2+s.moveX-s.startX>o?s.cellMatchList[r].x2+s.moveX-s.startX:o;if(s.cellflowList.length>0){var n=s.getMinWidthByCellList("max",s.cellflowList)-2*s.resize;a=a>n?n:a}s.layers[e]=i(i({},t),{},{x2:a,location:s.getCellLocation("move",i(i({},t),{},{x2:a}))})}if(-1!==h){var l=s.getMinWidthByCellList("min",s.cellMatchList)+2*s.resize,c=s.getMinWidthByCellList("max",s.cellflowList)-2*s.resize,u=s.cellflowList[h].x1+s.moveX-s.startX>l?s.cellflowList[h].x1+s.moveX-s.startX:l;u=u<c?u:c,s.layers[e]=i(i({},t),{},{x1:u,location:s.getCellLocation("move",i(i({},t),{},{x1:u}))})}})),this.isOpt="move",this.draw())}},{key:"resizeMultipleTop",value:function(t,e){var s=this;this.c.style.cursor="n-resize","down"!==this.mouseStatus||"m-top-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-top-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.y1>t-s.resize&&e.y1<t+s.resize&&s.cellMatchList.push(e),e.y2>t-s.resize&&e.y2<t+s.resize&&s.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r=s.cellMatchList.findIndex((function(e){return e.key===t.key})),h=s.cellflowList.findIndex((function(e){return e.key===t.key}));if(-1!==r){var o=s.getMinHeightByCellList("max",s.cellMatchList)-2*s.resize,a=s.cellMatchList[r].y1+s.moveY-s.startY<o?s.cellMatchList[r].y1+s.moveY-s.startY:o;if(s.cellflowList.length>0){var n=s.getMinHeightByCellList("min",s.cellflowList)+2*s.resize;a=a<n?n:a}s.layers[e]=i(i({},t),{},{y1:a,location:s.getCellLocation("move",i(i({},t),{},{y1:a}))})}if(-1!==h){var l=s.getMinHeightByCellList("min",s.cellflowList)+2*s.resize,c=s.getMinHeightByCellList("max",s.cellMatchList)-2*s.resize,u=s.cellflowList[h].y2+s.moveY-s.startY>l?s.cellflowList[h].y2+s.moveY-s.startY:l;u=u>c?c:u,s.layers[e]=i(i({},t),{},{y2:u,location:s.getCellLocation("move",i(i({},t),{},{y2:u}))})}})),this.isOpt="move",this.draw())}},{key:"resizeMultipleBottom",value:function(t,e){var s=this;this.c.style.cursor="s-resize","down"!==this.mouseStatus||"m-bottom-resize"!==this.tableStatus&&this.tableStatus||(this.tableStatus="m-bottom-resize",0===this.cellMatchList.length&&e.forEach((function(e){e.y2>t-s.resize&&e.y2<t+s.resize&&s.cellMatchList.push(e),e.y1>t-s.resize&&e.y1<t+s.resize&&s.cellflowList.push(e)})),this.layers.forEach((function(t,e){var r=s.cellMatchList.findIndex((function(e){return e.key===t.key})),h=s.cellflowList.findIndex((function(e){return e.key===t.key}));if(-1!==r){var o=s.getMinHeightByCellList("min",s.cellMatchList)+2*s.resize,a=s.cellMatchList[r].y2+s.moveY-s.startY>o?s.cellMatchList[r].y2+s.moveY-s.startY:o;if(s.cellflowList.length>0){var n=s.getMinHeightByCellList("max",s.cellflowList)-2*s.resize;a=a>n?n:a}s.layers[e]=i(i({},t),{},{y2:a,location:s.getCellLocation("move",i(i({},t),{},{y2:a}))})}if(-1!==h){var l=s.getMinHeightByCellList("min",s.cellMatchList)+2*s.resize,c=s.getMinHeightByCellList("max",s.cellflowList)-2*s.resize,u=s.cellflowList[h].y1+s.moveY-s.startY>l?s.cellflowList[h].y1+s.moveY-s.startY:l;u=u>c?c:u,s.layers[e]=i(i({},t),{},{y1:u,location:s.getCellLocation("move",i(i({},t),{},{y1:u}))})}})),this.isOpt="move",this.draw())}},{key:"getMinWidthByCellList",value:function(t,e){var i=e[0].x1,s=e[0].x2;return e.forEach((function(t){t.x2<s&&(s=t.x2),t.x1>i&&(i=t.x1)})),t?"min"===t?i:s:{min:i,max:s}}},{key:"getMinHeightByCellList",value:function(t,e){var i=e[0].y1,s=e[0].y2;return e.forEach((function(t){t.y2<s&&(s=t.xy),t.y1>i&&(i=t.y1)})),t?"min"===t?i:s:{min:i,max:s}}},{key:"drawImage",value:function(){var t=this;this.img.src=this.config.url,this.img.key=new Date,this.img.onload=function(){var e=t.img.width/t.c.width,i=t.img.height/t.c.height,s=e>i?e:i;t.imgRate=s>1?1/s:e>i?(t.c.width-40)/t.img.width:(t.c.height-40)/t.img.height,t.layers.push(t.getImgCoord()),t.drawOriginData(),t.draw()}}},{key:"drawOriginData",value:function(){var t=this;if(this.config.defaultData&&this.config.defaultData.length>0){var e,i,s=(null===(e=this.layers[0])||void 0===e?void 0:e.x1)||0,r=(null===(i=this.layers[0])||void 0===i?void 0:i.y1)||0;this.config.defaultData.forEach((function(e){var i=e.location;i.length>0&&t.layers.push({x1:i[0][0]*t.imgRate+s,y1:i[0][1]*t.imgRate+r,x2:i[1][0]*t.imgRate+s,y2:i[2][1]*t.imgRate+r,strokeStyle:t.drawSelectColor,location:i,type:"cell",w:1,h:1,key:(new Date).getTime()+"cell"+i[0][0]+s+i[0][1]+r})})),this.draw()}}},{key:"getImgCoord",value:function(){var t=this.img.width*this.imgRate,e=this.img.height*this.imgRate+20,i=0;return t<this.c.width&&(i=(this.c.width-t)/2),t>this.c.width&&(this.c.width=t),e>this.c.height&&(this.c.height=e),t<this.c.width&&e<this.c.height&&(this.c.width=t>document.body.clientWidth?t:document.body.clientWidth,this.c.height=e>document.body.clientHeight-64?e:document.body.clientHeight-64),{type:"img",x1:i,x2:i+t,y1:20,y2:e,isOpt:!1,key:(new Date).getTime()+"img"+i+0}}},{key:"draw",value:function(){var t=this;this.ctx.clearRect(0,0,this.c.width,this.c.height);var e=[];this.layers.forEach((function(i){if(t.ctx.beginPath(),t.ctx.setLineDash([]),t.ctx.lineWidth=1,"img"===i.type)t.ctx.drawImage(t.img,i.x1,i.y1,i.x2-i.x1,i.y2-i.y1);else if("cell"===i.type||"select"===i.type)t.current&&t.current.key===i.key||t.currentArray.length>0&&-1!==t.currentArray.findIndex((function(t){return t.key===i.key}))?e.push(i):(i.strokeStyle=t.drawSelectColor,t.ctx.rect(i.x1,i.y1,i.x2-i.x1,i.y2-i.y1));else if("table"===i.type){t.current&&t.current.key===i.key?(i.strokeStyle=t.selectActiveColor,i.lineWidth=2):i.strokeStyle=t.drawSelectColor,t.currentArray.length>0&&t.current&&"select"===t.current.type&&-1!==t.currentArray.findIndex((function(t){return t.key===i.key}))&&(i.strokeStyle=t.selectActiveColor,i.lineWidth=2);for(var s=0;s<=i.h;s++)t.ctx.moveTo(i.coord.tr[s].x1,i.coord.tr[s].y1),t.ctx.lineTo(i.coord.tr[s].x2,i.coord.tr[s].y2);for(var r=0;r<=i.w;r++)t.ctx.moveTo(i.coord.td[r].x1,i.coord.td[r].y1),t.ctx.lineTo(i.coord.td[r].x2,i.coord.td[r].y2)}t.ctx.strokeStyle=i.strokeStyle,t.ctx.lineWidth=i.lineWidth||1,t.ctx.stroke()})),e.forEach((function(e){t.ctx.beginPath(),t.ctx.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),t.ctx.strokeStyle=t.selectActiveColor,t.ctx.lineWidth=2,t.ctx.stroke()}))}},{key:"getScroll",value:function(){return{top:this.ctx.parent.scrollTop,left:this.ctx.parent.scrollLeft}}},{key:"zoom",value:function(t){var e=this;if("up"===t)this.imgRate+=.1;else if(this.imgRate<=.2){if(this.imgRate<=.02)return;this.imgRate-=.01}else this.imgRate-=.1;if(this.Recalculate(),this.current){var s=this.layers.findIndex((function(t){return t.key===e.current.key}));this.current=i({index:s},this.layers[s])}if(this.currentArray.length>0){var r=[];this.layers.forEach((function(t){-1!==e.currentArray.findIndex((function(e){return e.key===t.key}))&&r.push(t)})),this.currentArray=[].concat(r)}}},{key:"Recalculate",value:function(){var t=this,e=0,i=0;"image"===this.layers[0].type&&(this.layers[0]=this.getImgCoord(),e=this.layers[0].x1,i=this.layers[0].y1),this.layers.forEach((function(s){if("img"!==s.type&&s.location&&(s.x1=s.location[0][0]*t.imgRate+e,s.y1=s.location[0][1]*t.imgRate+i,s.x2=s.location[1][0]*t.imgRate+e,s.y2=s.location[2][1]*t.imgRate+i,"table"===s.type)){var r=[],h=[];s.coordLocation.td.forEach((function(s){r.push({x1:s.x1*t.imgRate+e,x2:s.x2*t.imgRate+e,y1:s.y1*t.imgRate+i,y2:s.y2*t.imgRate+i})})),s.coordLocation.tr.forEach((function(s){h.push({x1:s.x1*t.imgRate+e,x2:s.x2*t.imgRate+e,y1:s.y1*t.imgRate+i,y2:s.y2*t.imgRate+i})})),s.coord={td:r,tr:h}}})),this.draw()}},{key:"isPointInRetc",value:function(t,e){for(var s=0;s<this.layers.length;s++)if(("table"===this.layers[s].type||"cell"===this.layers[s].type||"select"===this.layers[s].type)&&this.layers[s].x1<=t&&t<=this.layers[s].x2&&this.layers[s].y1<=e&&e<=this.layers[s].y2)return i(i({},this.layers[s]),{},{index:s})}},{key:"windowToCanvas",value:function(t,e){var i=this.c.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"reSizeTable",value:function(){if(this.moveX>=this.current.x1&&this.moveX<=this.current.x1+this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y2||"left-resize"===this.tableStatus)this.resizeLeft();else if(this.moveX<=this.current.x2&&this.moveX>=this.current.x2-this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y2||"right-resize"===this.tableStatus)this.resizeRight();else if(this.moveY>=this.current.y1&&this.moveY<=this.current.y1+this.resize&&this.moveX>=this.current.x1+this.resize&&this.moveX<=this.current.x2-this.resize||"top-resize"===this.tableStatus)this.resizeTop();else if(this.moveY>=this.current.y2-this.resize&&this.moveY<this.current.y2&&this.moveX>=this.current.x1+this.resize&&this.moveX<this.current.x2-this.resize||"bottom-resize"===this.tableStatus)this.resizeBottom();else if(this.moveX>=this.current.x1&&this.moveX<=this.current.x1+this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y1+this.resize||"lt-resize"===this.tableStatus)this.resizeLT();else if(this.moveX<=this.current.x2&&this.moveX>=this.current.x2-this.resize&&this.moveY>=this.current.y1&&this.moveY<=this.current.y1+this.resize||"rt-resize"===this.tableStatus)this.resizeRT();else if(this.moveX>=this.current.x1&&this.moveX<=this.current.x1+this.resize&&this.moveY<=this.current.y2&&this.moveY>=this.current.y2-this.resize||"lb-resize"===this.tableStatus)this.resizeBL();else if(this.moveX<=this.current.x2&&this.moveX>=this.current.x2-this.resize&&this.moveY<=this.current.y2&&this.moveY>=this.current.y2-this.resize||"rb-resize"===this.tableStatus)this.resizeBR();else if("table"===this.current.type&&this.moveX>this.current.x1+this.resize&&this.moveX<this.current.x2-this.resize&&this.moveY>this.current.y1+this.resize&&this.moveY<this.current.y2-this.resize){for(var t=r(this.current.coord.td),e=r(this.current.coord.tr),i=!1,s=1;s<e.length-1;s++)if(this.moveY>e[s].y1-this.resize&&this.moveY<e[s].y1+this.resize&&"table-resize"!==this.tableStatus){i=!0,this.match.type="tr",this.match.index=s,this.c.style.cursor="n-resize";break}for(var h=1;h<t.length-1;h++)if(this.moveX>t[h].x1-this.resize&&this.moveX<t[h].x1+this.resize&&"table-resize"!==this.tableStatus){i=!0,this.match.type="td",this.match.index=h,this.c.style.cursor="w-resize";break}!i&&"table-resize"!==this.tableStatus||"down"!==this.mouseStatus||this.resizeTableLine(this.match)}}},{key:"movetable",value:function(){var t=this;if(!this.tableStatus||"moving"===this.tableStatus)if(this.tableStatus="moving",this.current){var e=this.moveX-this.leftDistance-this.current.x1,s=this.moveY-this.topDistance-this.current.y1;if(this.current.x2+=e,this.current.x1+=e,this.current.y2+=s,this.current.y1+=s,"table"===this.current.type){var r=[],h=[];this.current.coord.tr.forEach((function(t){r.push({x1:t.x1+e,y1:t.y1+s,x2:t.x2+e,y2:t.y2+s})})),this.current.coord.td.forEach((function(t){h.push({x1:t.x1+e,y1:t.y1+s,x2:t.x2+e,y2:t.y2+s})})),this.current.coord={tr:r,td:h}}else"select"===this.current.type&&this.currentArray.length>0&&this.layers.forEach((function(i,r){t.currentArray.forEach((function(h){if(h.key===i.key&&(t.layers[r].x2+=e,t.layers[r].x1+=e,t.layers[r].y2+=s,t.layers[r].y1+=s,t.layers[r].location=t.getCellLocation("move",i),"table"===i.type)){var o=[],a=[];i.coord.tr.forEach((function(t){o.push({x1:t.x1+e,y1:t.y1+s,x2:t.x2+e,y2:t.y2+s})})),i.coord.td.forEach((function(t){a.push({x1:t.x1+e,y1:t.y1+s,x2:t.x2+e,y2:t.y2+s})})),t.layers[r].coord={td:a,tr:o},t.layers[r].coordLocation=t.getTableLocation("move",i)}}))}));this.dealData("move")}else if(this.currentArray.length>0){var o="";this.currentArray.forEach((function(e){o=e.index?e.index:t.layers.findIndex((function(t){return t.key===e.key})),t.layers[o]=i(i({},t.layers[o]),{},{x1:e.x1+t.moveX-t.startX,x2:e.x2+t.moveX-t.startX,y1:e.y1+t.moveY-t.startY,y2:e.y2+t.moveY-t.startY}),t.layers[o].location=t.getCellLocation("move",t.layers[o])})),this.isOpt="move",this.draw()}}},{key:"resizeLeft",value:function(){var t=this;if(this.c.style.cursor="w-resize","down"===this.mouseStatus&&"lt-resize"!==this.tableStatus&&"lb-resize"!==this.tableStatus){if(this.tableStatus="left-resize",this.current.x1=this.moveX>this.current.x2-this.resize?this.current.x2-this.resize:this.moveX,"table"===this.current.type){var e=[],i=r(this.current.coord.td);this.current.coord.tr.forEach((function(s){e.push({x1:t.moveX>i[1].x1-t.resize?i[1].x1-t.resize:t.moveX,y1:s.y1,x2:s.x2,y2:s.y2})})),i[0].x1=this.moveX>i[1].x1-this.resize?i[1].x1-this.resize:this.moveX,i[0].x2=this.moveX>i[1].x1-this.resize?i[1].x1-this.resize:this.moveX,this.current.coord={tr:e,td:i}}this.dealData()}}},{key:"resizeRight",value:function(){var t=this;if(this.c.style.cursor="e-resize","down"===this.mouseStatus&&"rt-resize"!==this.tableStatus&&"rb-resize"!==this.tableStatus){if(this.tableStatus="right-resize",this.current.x2=this.moveX<this.current.x1+this.resize?this.current.x1+this.resize:this.moveX,"table"===this.current.type){var e=[],i=[];i=r(this.current.coord.td),this.current.coord.tr.forEach((function(s){e.push({x1:s.x1,y1:s.y1,x2:t.moveX>i[i.length-2].x2+t.resize?t.moveX:i[i.length-2].x2+t.resize,y2:s.y2})})),i[i.length-1].x1=this.moveX>i[i.length-2].x2+this.resize?this.moveX:i[i.length-2].x1+this.resize,i[i.length-1].x2=this.moveX>i[i.length-2].x2+this.resize?this.moveX:i[i.length-2].x1+this.resize,this.current.coord={tr:e,td:i}}this.dealData()}}},{key:"resizeTop",value:function(){var t=this;if(this.c.style.cursor="n-resize","down"===this.mouseStatus&&"lt-resize"!==this.tableStatus&&"rt-resize"!==this.tableStatus){if(this.tableStatus="top-resize",this.current.y1=this.moveY>this.current.y2-this.resize?this.current.y2-this.resize:this.moveY,"table"===this.current.type){var e=[],i=[];e=r(this.current.coord.tr),this.current.coord.td.forEach((function(s){i.push({x1:s.x1,y1:t.moveY>e[1].y1-t.resize?e[1].y1-t.resize:t.moveY,x2:s.x2,y2:s.y2})})),e[0].y1=this.moveY>e[1].y1-this.resize?e[1].y1-this.resize:this.moveY,e[0].y2=this.moveY>e[1].y1-this.resize?e[1].y1-this.resize:this.moveY,this.current.coord={tr:e,td:i}}this.dealData()}}},{key:"resizeBottom",value:function(){var t=this;if(this.c.style.cursor="s-resize","down"===this.mouseStatus&&"lb-resize"!==this.tableStatus&&"rb-resize"!==this.tableStatus){if(this.tableStatus="bottom-resize",this.current.y2=this.moveY<this.current.y1+this.resize?this.current.y1+this.resize:this.moveY,"table"===this.current.type){var e=[],i=[];e=r(this.current.coord.tr),this.current.coord.td.forEach((function(s){i.push({x1:s.x1,y1:s.y1,x2:s.x2,y2:t.moveY>e[e.length-2].y2+t.resize?t.moveY:e[e.length-2].y2+t.resize})})),e[e.length-1].y1=this.moveY>e[e.length-2].y2+this.resize?this.moveY:e[e.length-2].y2+this.resize,e[e.length-1].y2=this.moveY>e[e.length-2].y2+this.resize?this.moveY:e[e.length-2].y2+this.resize,this.current.coord={tr:e,td:i}}this.dealData()}}},{key:"resizeLT",value:function(){var t=this;if(this.c.style.cursor="nw-resize","down"===this.mouseStatus){this.tableStatus="lt-resize";var e=this.moveY-this.current.y1;if(this.current.x1=this.moveX,this.current.y1=this.moveY,"table"===this.current.type){var i=[],s=[];this.current.coord.tr.forEach((function(e){i.push({x1:t.moveX>t.current.coord.td[1].x1-t.resize?t.current.coord.td[1].x1-t.resize:t.moveX,y1:e.y1,x2:e.x2,y2:e.y2})})),i[0].y1+=e,i[0].y2+=e,this.current.coord.td.forEach((function(t){s.push({x1:t.x1,y1:t.y1+e,x2:t.x2,y2:t.y2})})),s[0].x1=this.moveX>s[1].x1-this.resize?s[1].x1-this.resize:this.moveX,s[0].x2=this.moveX>s[1].x1-this.resize?s[1].x1-this.resize:this.moveX,this.current.coord={tr:i,td:s}}this.dealData()}}},{key:"resizeRT",value:function(){var t=this;if(this.c.style.cursor="ne-resize","down"===this.mouseStatus){this.tableStatus="rt-resize";var e=this.moveY-this.current.y1;if(this.current.x2=this.moveX,this.current.y1=this.moveY,"table"===this.current.type){var i=[],s=[];this.current.coord.tr.forEach((function(e){i.push({x1:e.x1,y1:e.y1,x2:t.moveX,y2:e.y2})})),i[0].y1+=e,i[0].y2+=e,this.current.coord.td.forEach((function(t){s.push({x1:t.x1,y1:t.y1+e,x2:t.x2,y2:t.y2})})),s[s.length-1].x1=this.moveX,s[s.length-1].x2=this.moveX,this.current.coord={tr:i,td:s}}this.dealData()}}},{key:"resizeBL",value:function(){var t=this;if(this.c.style.cursor="sw-resize","down"===this.mouseStatus){this.tableStatus="lb-resize";var e=this.moveY-this.current.y2;if(this.current.x1=this.moveX,this.current.y2=this.moveY,"table"===this.current.type){var i=[],s=[];this.current.coord.tr.forEach((function(e){i.push({x1:t.moveX,y1:e.y1,x2:e.x2,y2:e.y2})})),i[i.length-1].y1+=e,i[i.length-1].y2+=e,this.current.coord.td.forEach((function(t){s.push({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2+e})})),s[0].x1=this.moveX,s[0].x2=this.moveX,this.current.coord={tr:i,td:s}}this.dealData()}}},{key:"resizeBR",value:function(){var t=this;if(this.c.style.cursor="se-resize","down"===this.mouseStatus){this.tableStatus="rb-resize";var e=this.moveY-this.current.y2;if(this.current.x2=this.moveX,this.current.y2=this.moveY,"table"===this.current.type){var i=[],s=[];this.current.coord.tr.forEach((function(e){i.push({x1:e.x1,y1:e.y1,x2:t.moveX,y2:e.y2})})),i[i.length-1].y1+=e,i[i.length-1].y2+=e,this.current.coord.td.forEach((function(t){s.push({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2+e})})),s[s.length-1].x1=this.moveX,s[s.length-1].x2=this.moveX,this.current.coord={tr:i,td:s}}this.dealData()}}},{key:"resizeTableLine",value:function(t){var e=r(this.current.coord.td),s=r(this.current.coord.tr);if(this.tableStatus="table-resize","td"===t.type){var h=Object.assign({},e[t.index]),o=e[t.index-1].x1+3*this.resize,a=e[t.index+1].x1-3*this.resize;e[t.index]=i(i({},h),{},{x1:this.moveX<o?o:this.moveX>a?a:this.moveX,x2:this.moveX<o?o:this.moveX>a?a:this.moveX})}else{var n=Object.assign({},s[t.index]),l=s[t.index-1].y1+3*this.resize,c=s[t.index+1].y1-3*this.resize;s[t.index]=i(i({},n),{},{y1:this.moveY<l?l:this.moveY>c?c:this.moveY,y2:this.moveY<l?l:this.moveY>c?c:this.moveY})}this.current.coord={td:e,tr:s},this.dealData()}},{key:"dealData",value:function(t){var e=this;this.isOpt=t||"resize",this.current.location=this.getCellLocation("move",this.current),"table"===this.current.type&&(this.current.coordLocation=this.getTableLocation("move",this.current));var i;i=this.current.index?this.current.index:this.layers.findIndex((function(t){return t.key===e.current.key})),this.layers[i]=this.current,this.draw()}},{key:"getCellLocation",value:function(t,e){var i=0,s=0;"iamge"===this.layers[0].type&&(i=this.layers[0].x1,s=this.layers[0].y1);var r=(("draw"===t?this.startX:e.x1)-i)/this.imgRate,h=(("draw"===t?this.startY:e.y1)-s)/this.imgRate,o=(("draw"===t?this.moveX:e.x2)-i)/this.imgRate,a=(("draw"===t?this.moveY:e.y2)-s)/this.imgRate;return[[r,h],[o,h],[r,a],[o,a]]}},{key:"getTableLocation",value:function(t,e){var i=this,s=0,r=0;"iamge"===this.layers[0].type&&(s=this.layers[0].x1,r=this.layers[0].y1);var h=[],o=[],a="draw"===t?this.coord:e.coord;return a.tr.forEach((function(t){o.push({x1:(t.x1-s)/i.imgRate,y1:(t.y1-r)/i.imgRate,x2:(t.x2-s)/i.imgRate,y2:(t.y2-r)/i.imgRate})})),a.td.forEach((function(t){h.push({x1:(t.x1-s)/i.imgRate,y1:(t.y1-r)/i.imgRate,x2:(t.x2-s)/i.imgRate,y2:(t.y2-r)/i.imgRate})})),{tr:o,td:h}}},{key:"revoke",value:function(){var t=this;if(this.history.length>=1){var e=this.history.pop();if("move"===e.type||"resize"===e.type)if(e.selectOpt)this.layers.forEach((function(i,s){e.originData.forEach((function(e){e.key===i.key&&(t.layers[s]=e)}))}));else{var i=this.layers.findIndex((function(t){return t.key===e.data.key}));this.layers[i]=e.originData}else if("delete"===e.type)e.selectOpt?this.layers=this.layers.concat(e.originData):this.layers.push(e.originData);else if("draw"===e.type)if(e.data instanceof Array){var s=[];this.layers.forEach((function(t){var i=!1;e.data.forEach((function(e){t.key===e.key&&(i=!0)})),i||s.push(t)})),this.layers=[].concat(s),e.originData=r(e.data)}else{var h=this.layers.findIndex((function(t){return t.key===e.data.key}));e.originData=this.layers[h],this.layers.splice(h,1)}this.deleteHistory.push(e),this.draw()}}},{key:"reRevoke",value:function(){var t=this;if(this.deleteHistory.length>0){var e=this.deleteHistory.pop();if("move"===e.type||"resize"===e.type)if(e.selectOpt)this.layers.forEach((function(i,s){e.data.forEach((function(e){e.key===i.key&&(t.layers[s]=e)}))}));else{var s=this.layers.findIndex((function(t){return t.key===e.data.key}));this.layers[s]=i({},e.data)}else if("delete"===e.type)if(e.selectOpt){var r=[];this.layers.forEach((function(t){var i=!1;e.originData.forEach((function(e){e.key===t.key&&(i=!0)})),i||r.push(t)})),this.layers=r}else{var h=this.layers.findIndex((function(t){return t.key===e.originData.key}));this.layers.splice(h,1)}else"draw"===e.type&&(e.originData instanceof Array?this.layers=this.layers.concat(e.originData):this.layers.push(e.originData));this.history.push(e),this.draw()}}},{key:"delete",value:function(){var t=this;if(this.current){if("select"===this.current.type){var e=[],i=[];this.layers.forEach((function(s){var r=!1;t.currentArray.forEach((function(t){s.key===t.key&&(r=!0)})),r?i.push(s):e.push(s)})),this.history.push({type:"delete",selectOpt:!0,data:"",originData:[].concat(i)}),this.layers=e}else{this.history.push({type:"delete",data:"",originData:this.current});var s=this.layers.findIndex((function(e){return e.key===t.current.key}));this.layers.splice(s,1)}this.noUpdate=this.checkIsSave(),this.current=null,this.draw(),this.c.style.cursor="default"}else if(this.currentArray.length>0){var r=[],h=[];this.layers.forEach((function(e){-1===t.currentArray.findIndex((function(t){return t.key===e.key}))?r.push(e):h.push(e)})),this.history.push({type:"delete",selectOpt:!0,data:[],originData:[].concat(h)}),this.layers=[].concat(r),this.currentArray=[],this.noUpdate=this.checkIsSave(),this.draw(),this.c.style.cursor="default"}}},{key:"removeSelect",value:function(){var t=this.layers.findIndex((function(t){return"select"===t.type}));-1!==t&&this.layers.splice(t,1)}},{key:"fixPosition",value:function(t){if(t.x1>t.x2){var e=t.x1;t.x1=t.x2,t.x2=e}if(t.y1>t.y2){var i=t.y1;t.y1=t.y2,t.y2=i}return t}},{key:"findSelectArray",value:function(t){var e=this;this.currentArray=[],this.layers.forEach((function(s){s.x1>=t.x1&&s.x2<=t.x2&&s.y1>=t.y1&&s.y2<=t.y2&&"select"!==s.type&&"img"!==s.type&&e.currentArray.push(i({},s))}))}},{key:"saveDraw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=[],h=0,o=0;"iamge"===this.layers[0].type&&(h=this.layers[0].x1,o=this.layers[0].y1);var a={};this.layers.forEach((function(e){if("cell"===e.type){var a=parseInt((e.x1-h)/t.imgRate),n=parseInt((e.y1-o)/t.imgRate),l=parseInt((e.x2-h)/t.imgRate),c=parseInt((e.y2-o)/t.imgRate);s.push(i(i({},e),{},{location:[[a,n],[l,n],[l,c],[a,c]],x1:a,y1:n,x2:l,y2:c}))}else if("table"===e.type){var u=t.transTable(e,h,o);s.push.apply(s,r(u))}})),s.sort((function(t,e){return Number(t.y1)-Number(e.y1)}));for(var n=0;n<s.length;n++)a[s[n].y1]?a[s[n].y1].push(s[n]):a[s[n].y1]=[s[n]];var l=[],c=Object.keys(a);return c.sort((function(t,e){return t-e})).forEach((function(t){var e=a[t];e.sort((function(t,e){return t.x1-e.x1})),l.push.apply(l,r(e))})),e||(this.saveCurrent=[].concat(l),this.history=[],this.deleteHistory=[],this.current=null,this.noUpdate=!0),l}},{key:"transTable",value:function(t,e,s){for(var r=t.coord.td,h=t.coord.tr,o=[],a=0;a<t.w;a++)for(var n=0;n<t.h;n++){var l=parseInt((r[a].x1-e)/this.imgRate),c=parseInt((h[n].y1-s)/this.imgRate),u=parseInt((r[a+1].x1-e)/this.imgRate),y=parseInt((h[n+1].y1-s)/this.imgRate);o.push(i(i({},t),{},{location:[[l,c],[u,c],[u,y],[l,y]],x1:l,y1:c,x2:u,y2:y}))}return o}},{key:"setMode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"cell",tr:1,td:1};this.mode=t||"select","draw"===t?(this.c.style.cursor="crosshair",this.drawType=e,this.current=null,this.currentArray=[]):(this.draw.drawType={},"drawSelect"===t&&(this.c.style.cursor="crosshair",this.current=null,this.currentArray=[])),this.draw()}},{key:"resetConfig",value:function(t){this.config=Object.assign(this.config,t),this.layers=[],this.current=null,this.imgRate=1,this.history=[],this.noUpdate=!0,this.deleteHistory=[],this.currentArray=[],this.saveCurrent=[],this.c.width=document.body.clientWidth,this.c.height=document.body.clientHeight-64,this.mode="select",this.config.url?this.drawImage():this.drawOriginData()}},{key:"checkIsSave",value:function(){var t=!0,e=this.saveDraw("check");if(this.saveCurrent.length===e.length)for(var i=0;i<this.saveCurrent.length;i++)this.saveCurrent[i].x1===e[i].x1&&this.saveCurrent[i].x2===e[i].x2&&this.saveCurrent[i].y1===e[i].y1&&this.saveCurrent[i].y2===e[i].y2||(t=!1);else t=!1;return t}}],s&&a(e.prototype,s),Object.defineProperty(e,"prototype",{writable:!1}),t}();return t.default=(n=null,function(t,e){return n?n.resetConfig({}):n=new l(t,e),n}),t}()}));